name: Benchmarks

on:
  schedule:
    - cron: "0 5 * * 6" # Every Saturday at 5:00 UTC
  push:
    branches:
      - master

jobs:
  bench:
    name: Benchmarks
    runs-on: parity-benchmark
    container:
      image: "paritytech/ci-unified:bullseye-1.85.0-2025-01-28-v202504231537"
    steps:
      - name: Checkout Sources
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6.0.0

      - name: Rust Cache
        uses: Swatinem/rust-cache@98c8021b550208e191a6a3145459bfc9fb29c4c0 # v2.8.0

      - name: run benchmarks
        run: cargo bench -p jsonrpsee-benchmarks -- --output-format bencher | tee output.txt

      - name: Store benchmark result
        uses: rhysd/github-action-benchmark@4e0b38bc48375986542b13c0d8976b7b80c60c00 # v1.20.5
        with:
          tool: "cargo"
          output-file-path: "output.txt"
          benchmark-data-dir-path: "bench/dev2"
          fail-on-alert: true
          github-token: ${{ secrets.GITHUB_TOKEN }}
          comment-on-alert: true
          auto-push: true
