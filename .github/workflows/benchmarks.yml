name: Benchmarks

on:
  schedule:
    - cron: "0 5 * * 6" # Every Saturday at 5:00 UTC
  push:
    branches:
      - master

jobs:
  bench:
    name: Benchmarks
    runs-on: parity-benchmark
    container:
      image: "paritytech/ci-unified:bullseye-1.85.0-2025-01-28-v202504231537"
    steps:
      - name: Checkout Sources
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0

      - name: Rust Cache
        uses: Swatinem/rust-cache@98c8021b550208e191a6a3145459bfc9fb29c4c0 # v2.8.0

      - name: run benchmarks
        run: cargo bench -p jsonrpsee-benchmarks -- --output-format bencher | tee output.txt

      - name: Store benchmark result
        uses: rhysd/github-action-benchmark@d48d326b4ca9ba73ca0cd0d59f108f9e02a381c7 # v1.20.4
        with:
          tool: "cargo"
          output-file-path: "output.txt"
          benchmark-data-dir-path: "bench/dev2"
          fail-on-alert: true
          github-token: ${{ secrets.GITHUB_TOKEN }}
          comment-on-alert: true
          auto-push: true
